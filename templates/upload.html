<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Inventory Management Dashboard</title>
    <!-- Include Bootstrap CSS for styling -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
    <!-- Include Plotly.js for data visualization -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <div class="container">
        <h1 class="my-4 text-center">Inventory Management Dashboard</h1>
        <!-- Display the calculated metrics -->
        <div class="row text-center">
            <div class="col-md-3">
                <h3 id="totalVendors">0</h3>
                <p>Total Vendors</p>
            </div>
            <div class="col-md-3">
                <h3 id="totalCategories">0</h3>
                <p>Total Categories</p>
            </div>
            <div class="col-md-3">
                <h3 id="totalProducts">0</h3>
                <p>Total Products</p>
            </div>
            <div class="col-md-3">
                <h3 id="totalSales">0</h3>
                <p>Total Sales</p>
            </div>
        </div>
        <!-- File upload section -->
        <div class="my-4 text-center">
            <input type="file" id="fileInput" accept=".csv" class="form-control-file">
            <button onclick="uploadFile()" class="btn btn-primary mt-2">Upload and Analyze</button>
        </div>
        <!-- Container for the sales report chart -->
        <div id="salesReportChart" style="height: 400px;"></div>
    </div>
    <!-- JavaScript for handling file upload and displaying data -->
    <script>
        function uploadFile() {
            const fileInput = document.getElementById('fileInput');
            if (fileInput.files.length === 0) {
                alert('Please upload a file.');
                return;
            }
            const formData = new FormData();
            formData.append("file", fileInput.files[0]);
            fetch('/upload', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => displayData(data))
            .catch(error => console.error('Error:', error));
        }

        function displayData(data) {
            // Update the calculated metrics on the dashboard
            document.getElementById('totalVendors').textContent = data.totalVendors;
            document.getElementById('totalCategories').textContent = data.totalCategories;
            document.getElementById('totalProducts').textContent = data.totalProducts;
            document.getElementById('totalSales').textContent = data.totalSales;

            // Plot the sales report chart using Plotly
            const traces = data.salesReport.map(report => ({
                x: report.x,
                y: report.y,
                name: report.name,
                mode: 'lines'
            }));
            const layout = {
                title: 'Sales Report',
                xaxis: { title: 'Date' },
                yaxis: { title: 'Sales' }
            };
            Plotly.newPlot('salesReportChart', traces, layout);
        }
    </script>
</body>
</html>
